

## 인터넷
---
인터넷이란,  "전 세계에 걸쳐 파일 전송 등의 데이터 통신 서비스를 받을 수 있는 컴퓨터 네트워크의 시스템"

프로토콜이란,  "네트워크 통신을 위해 미리 정해놓은 공통된 메뉴얼"

TCP/IP란, "인터넷에서 컴퓨터들이 서로 정보를 주고 받는데 쓰이는 프로토콜의 집합"



## TCP/IP 계층
---
TCP/IP 계층에는 총 4개의 계층이 있습니다


### Application Layer
- 특정 서비스를 제공하기 위해 애플리케이션 끼리 정보를 주고 받을 수 있습니다.
- FTP, HTTP, SSH, Telnet, DNS, SMTP

### Transport Layer
- 송신된 데이터를 수신측 애플리케이션에 전달하는 역할을 합니다.
- 포트 번호를 사용해서 애플리케이션을 찾아주는 역할을 합니다.
- TCP, UDP, RTP, RTCP

### Internet Layer
- 수신 측 까지 데이터를 전달하기 위해 사용됩니다.
- IP 주소를 바탕으로 올바른 목적지로 찾아 갈 수 있도록 해줍니다.
- IP, ARP, ICMP, RARP, OSPF

### Network Access Layer
- 네트워크에 직접 연결된 기기 간 전송을 도와줍니다.
- 물리적 주소인 MAC 주소를 사용합니다.
- Ethernet, PPP, Token Ring

---

1계층- 물리계층 - Physical Layer

-   0과 1의 나열을 아날로그 신호로 바꾸어 전선에 흘려보내는 것. (encoding)
-   아날로그 신호가 들어오면 0과 1의 나열로 해석하는것 (decoding)
-   물리적으로 연결된 두 대의 컴퓨터가 0과 1의 나열을 주고받을수 있게 해주는 모듈(module)
-   1계층 모듈은 하드웨어 적으로 구현되어 있습니다. (PHY칩)

2계층 - 데이터링크 계층 - Data-Link Layer

-   같은 네트워크에 있는 여러 대의 컴퓨터들이 데이터를 주고 받기위해서 필요한 모듈
-   Framing 은 Data-link Layer에 속하는 작업중 하나 입니다.
-   2계층 모듈도 1계층 처럼 하드웨어로 구현되어 있습니다 (랜카드)

3계층 - 네트워크 계층 - Network Layer

-   수많은 네트워크들의 연결로 이루어지는 인터넷속에서, 목적지 로 데이터를 전달하기위해,
-   IP주소를 이용하여 길을 찾고(routing)
-   자신 다음의 라우터에게 데이터를 넘겨 주는것(forwarding)
-   3계층은 운영체제의 커널에 소프트웨어 적으로 구현이 되어 있습니다.

4계층 - 전송계층 - Transport Layer

-   Port 번호를 사용하여 최종 목적지 프로세스에 까지 데이터가 도달 할 수 있도록 하는 모듈
-   4계층 역시 운영체제의 커널에 소프트웨어 적으로 구현이 되어 있습니다.




## TCP/IP 흐름
---
Application Layer -> Transport Layer -> Internet Layer -> Network Access Layer

브라우저에 google.com 을 입력했다는 가정을 하고 TCP/IP의 흐름에 대해 설명합니다.

#### Application Layer
google.com의 의미는 google.com:80 포트로 HTTP 프로토콜을 사용해 데이터를 요청해라 라는 의미가 됩니다. 
HTTP Request 메시지를 만들어 보냅니다.
![[Pasted image 20230409222053.png]]

#### Transport Layer
Transport Layer 에서는 TCP 패킷에 데이터를 담는 역할을 수행합니다.
패킷에는 각 계층에 필요한 정보들이 담겨야합니다.
![[Pasted image 20230409222118.png]]
SP 와 DP는 각각 시작 포트 번호와 목적지 포트 번호를 의미 합니다.

#### Internet Layer
DNS 서버로부터 라우팅테이블의 정보로 부터 도메인을 통해 매칭된 IP를 받습니다.
![[Pasted image 20230409222957.png]]

#### Network Access Layer
이제 Ethernet 프로토콜에 대한 MAC 주소를 만들어야합니다.
![[Pasted image 20230409223058.png]]

IP 주소로 MAC 주소를 알아내기 위해서는 "주소해석 프로토콜인 ARP 프로토콜을 사용합니다."     [[ARP 프로토콜]]
MAC 주로까지 알아냈으면, 외부 네트워크로 나갈 준비가 완료 되었습니다.


---

잠깐,  TCP 프로토콜은 데이터를 전송하기 전에, 송신측과 수신측이 서로 연결되는 작업이 필요합니다.

![[Pasted image 20230409224041.png]]

이러한 작업을 3-Way-Handshaking 이라고 합니다.

3-Way-Handshaking 에서는 ACK 와 SYN 플래그가 사용됩니다.

![[Pasted image 20230409224249.png]]

1. 클라이언트는 서버에게 접속을 요청하는 SYN 패킷을 보냅니다.
2. 서버는 SYN 요청을 받고, 클라이언트에게 요청을 수락한다는 ACK와 SYN 플래그거 설정된 패킷을 보냅니다.
3. 클라이언트는 서버에게 다시 ACK 패킷을 보냅니다.
4. 이제부터 연결이 이루어지고 데이터가 오고 갈 수 있게 됩니다.


우리가 사용하는 컴퓨터는 Private IP를 사용합니다.  그래서 외부로 나갈때 Private IP를 Public IP로 변환하여 나가게 됩니다. 이 변환작업을 공유기를 통해 수행합니다.

![[Pasted image 20230409224651.png]]

이러한 작업을 [[(작성중) NAT (Network Address Translation)]] 이라고 합니다.


![[Pasted image 20230409225038.png]]
우리집을 나가서 구글에 도착하기위해 많은 라우터를 거치게 되는데 이러한 작업을 [[(작성중) Routing (라우팅)]] 이라고 합니다.


라우팅을 거쳐 구글 서버가 연결된 라우터 까지 데이터가 도착하면 패킷의 IP해더에 기록된 구글서버 IP 주소를 통해 MAC 주소를 얻어와야 합니다.  (ARP 프로토콜 사용)   [[ARP 프로토콜]]
![[Pasted image 20230409225149.png]]

ARP는 라우터가 연결된 네트워크에 [[(작성중) 브로드캐스팅]] 됩니다.


구글 서버가 자신의 IP로 온 ARP 요청을 받고 MAC 주소를 응답해줍니다.
![[Pasted image 20230409225503.png]]
이제 데이터가 물리적으로 전달 될 수 있습니다. 드디어 구글서버에 데이터가 도착했습니다.

이제 Transport Layer 에서 80 포트로 데이터를 전달해 줍니다.

Application Layer 에서 웹서버가 사용될 HTTP Request 데이터를 얻을 수 있게 됩니다.
![[Pasted image 20230409225758.png]]

이제 HTTP Request를 통해 받은 응답이 다시 역순으로 우리집으로 오게 됩니다.

마지막으로 HTTP 요청과 응답이 끝나면, 연결을 종료해야합니다.  여기서도 TCP의 컨트롤 비트가 사용됩니다.


![[Pasted image 20230409225954.png]]

4-Way-Handshaking 에서는 ACK와 FIN 플래그가 사용됩니다.

![[Pasted image 20230409230309.png]]

1. 클라이언트가 서버로 연결을 종료 하겠다는 FIN 플래그를 전송합니다.
2. 서버는 클라이언트에게 ACK 메시지를 보내고, 자신의 통신이 끝날때 까지 기다립니다.
3. 서버가 통신이 끝나면 클라이언트로 FIN 을 보냅니다.
4. 클라이언트는 확인했다는 의미로 서버에서 ACK 플래그를 보내면, 연결이 종료됩니다.


서버가 FIN을 보내는 과정에서 한 가지 문제가 발생할 수 있습니다.

![[Pasted image 20230409230530.png]]

FIN을 보내기 전에 보냈던 데이터가 FIN보다 늦게 도착 할 경우 가 돈재 할 수 있습니다.
서버로 부터 FIN을 수신했다고, 클라이언트가 바로 연결된 소켓을 닫아버리면 FIN을 보내기 전에 보낸 패킷은 영영 클라이언트가 받을수 없게 됩니다.

![[Pasted image 20230409230545.png]]

그래서 클라이언트는 서버로 부터 FIN 요청을 받더라도 일정시간 소켓을 닫지 않고 혹시나 아직 도착하지 않은 잉여 패킷을 기다립니다. 
이렇게 4-Way-Handshaking 과정이 완료되어도 소켓을 닫지 않고 잉여 패킷을 기다리는 상태를 TIME_WAT 이라고 합니다.

## 신뢰할 수 있는 TCP
---
TCP는 연결 지향형 프로토콜인 동시에 신뢰할 수 있는 프로토콜 입니다.

요즘 인터넷 세상은 엄청나게 큰 데이터를 주고 받습니다.
![[Pasted image 20230409230857.png]]

그래서 한개의 패킷으로만 주고 받기에는 상당한 무리가 있습니다. 
![[Pasted image 20230409230928.png]]

그래서 데이터를 잘게 쪼개서 보내게 되고 ,  많은 패킷을 보내게 됩니다. 

그리고 이러한 패킷들은 엄청 복작한 인터넷을 통해 목적지로 이동합니다. 

이러한 복잡한 환경에서 데이터의 유실로부터  TCP는 그 어려운 것을 해냅니다. 

TCP는 흐름제어, 오류제어, 혼잡제어를 통해 신뢰성 있는 데이터 전송을 보장할 수 있게 해줍니다. 
[[(작성중) TCP 프로토콜]]





## 참고 Reference
---
[[10분 테코톡] 🔮 수리의 TCP/IP - YouTube](https://www.youtube.com/watch?v=BEK354TRgZ8)