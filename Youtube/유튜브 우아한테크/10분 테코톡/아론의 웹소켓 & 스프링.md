#Spring #WebSocket


## 웹소켓? 언제쓰지?
---
웹소켓은 웹에서 상대방과 실시간 통신 을 하기위한 기술입니다.
웹소켓은 텍스트와 바이너리 타입의 데이터를 양방향으로 주고받기 위한 프로토콜 입니다.


웹소켓은 `전이중 통신 채널`을 제공하기 때문에 `실시간성 보장`을 할 수 있습니다.

따라서, 웹소켓은 실시간성을 보장해야하는 서비스 들에 활용되고 있습니다.
- 게임, 채팅, 실시간 주식 거래 등등

	꼭 웹소켓을 써야만 실시간성을 보장 받을 수 있을까요?
	
	ㄴㄴ,  HTTP 에서도 실시간성을 보장하는 기법이 존재합니다.
	-  Polling, Long Polling, Streaming


## 웹소켓 vs HTTP
---
하지만,  일반적으로 웹 소켓을 활용할 수 있는 환경이라면 웹 소켓 기술을 활용하는 것이 일반적입니다.

웹소켓 과 HTTP의 가장 큰 차이점은 수립된 커넥션을 어떻게 하느냐 입니다.

### HTTP
---
비연결성
매번 연결 맻고 끊는 과정의 비용
(요청 - 응답) 구조

매번 방대한 양의 데이터를 서버로 보내야합니다.

![[Pasted image 20230409213822.png]]

### 웹소켓
---
연결지향
한번 연결 맻은 뒤 유지
양뱡향 통신

처음 연결 할때만 HTTP 통신을 하고, 다음 쓸때 부터는 간단한 데이터만 오고갑니다.
![[Pasted image 20230409213911.png]]

![[Pasted image 20230409213939.png]]

HTTP와 웹소켓은 보내야 하는 데이터의 양에서도 차이가 납니다.  웹소켓이 훨씬 적음...
따라서 실시간 통신을 위해서는 웹소켓을 사용하는 것이 좋다.

### 웹소켓 지원 현황
---
![[Pasted image 20230409214206.png]]
- ["Web Sockets" | Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/?search=Web%20Sockets)

웹 소켓을 지원하지 않는 브라우저에서는 ?
- SocketJs, Socket.io 와 같은 라이브러리를 통해서 비슷한 기능을 구현 할 수 있습니다.


## 웹소켓 in Spring
---
![[Pasted image 20230409214342.png]]

SocketTextHandler()
- 직접 구현한 웹소켓 핸들러

/user
- 웹소켓 연결 주소


## STOMP and Spring-Messaging
---

### STOPM
- Simple Text Oriented Messaging Protocol
- 메시지 브로커를 활용하여 쉽게 메시지를 주고 받을 수 있는 프로토콜
- 웹소켓 위게 얹어 함께 사용할 수 있는 하위(서브) 프로토콜

STOMP 는 웹소켓을 사용할때 프로젝트의 규모가 커지고, 협업하는 상황이 많이지면 유용하게 활용할 수 있습니다.

STOMP는 프레임 단위의 프로토콜을 사용하여, 데이터를 주고 받습니다.
```
COMMAND
header1:value1
header2:value2

Body^@
```
- 프레임단위는 커멘드, 헤더, 바디 로 구성되어 있습니다.


통신 흐름
![[Pasted image 20230409215840.png]]


### STOMP를 사용하는 장점
---
- 하위 프로토콜 혹은 컨벤션을 따로 정의할 필요 없다
- 연결 주소마다 새로 핸들러를 구현하고 설정해줄 필요가 없다.
- 외부 Messaging Queue를 사용할 수 있다. (RavvitMQ, 카프카 등등)
- Spring Security 를 사용할 수 있다.



## 참고 Reference
---
[[10분 테코톡] ✨ 아론의 웹소켓&스프링 - YouTube](https://www.youtube.com/watch?v=rvss-_t6gzg)
