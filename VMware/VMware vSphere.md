	VMware vSphere는 VMware의 대표적인솔루션으로, 2009년에 등장한 서버 가상화 플랫폼이다.

```
**VMware vSphere 장점**

- 비용 효율성이 뛰어난 컴퓨팅 리소스에 애플리케이션 워크로드를 효율적으로 배치할 수 있다.

**백업 프랙티스 8가지**

**1. 게스트 OS 계층에서 VM을 백업하지 말라**

- 일반적인 백업 형태인 게스트OS 계층에서의 백업은 불필요한 VM 리소스 소비를 유발시키고,
호스트에서 실행되는 다른 시스템의 성능에도 영향을 준다.

따라서, 데이터를 가상화 계층에서 백업시켜야하는데, 이때는 .vmdk 파일에 대해 이미지 레벨 백업
을 사용하여 게스트 OS 가 연관되지 않도록 한다.

이를 위해서는 가상화 환경에서 작동하도록 설계하고, 호스트나 게스트 OS를 사용하지 않고도 직접
시스템의 가상 디스크를 백업할 수 있는 백업 애플리케이션을 사용해야 한다.

이렇게 되면, 불필요한 리소스 소비를 제거하면서 VM이 워크로드에 필요한 리소스를 확보하도록 할
수 있다.

**2. vStorage API를 활용하라.**

- vStorage API는 vSphere와 함께 도입되었으며, 호스트로부터 백업 처리를 오프로드하는 작업을
지원하기위해 VMware 인프라스트럭처 3과 함께 릴리즈된 VMware Consolidated Backup 프레임워크
를 대체한다.

vStorage API는 가상 시스템의 디스크 파일에 간단히 엑세스할 수 있도록 지원하며, 백업 속도를
대폭 향상시키는 고유한 기능(예: 변경 블록 트래킹 기능)이 있다.

CBT(Change Block Tracking, 변경 블록 트래킹)는 마지막 백업 이후 변경된 블록을 모두 트래킹
하는 기능으로, 백업 애플리케이션이 VMkernel만 쿼리하면 정보를 얻을 수 있다.

이는 백업 애플리케이션에서 더 이상 변경된 데이터를 트래킹할 필요가 없다는 것을 의미하며, 이에
따라 더 빠른 증분 백업이 가능하다.

**3. VM 백업 리소스에 과감히 투자하라.**

- 백업 윈도우를 최소화 하려면 백업 서버에 적합한 하드웨어 및 소프트웨어를 구비하여 작업 병목
현상을 방지하도록 해야한다. 충분한 메모리, CPU, 네트워크 대역폭이 필요하다.

백업 서버는 소스에서 대상 스토리지 디바이스로 단순히 데이터를 이전하는 것 이상의 작업을 수행
하며, 데이터중복 제거 및 압축을 수행하여 백업 세트의 크기를 감축할 수 있다.

**4. 신중하게 백업을 예악하고 테스트 하라.**

- 가상 환경 백업의 경우 공유된 가상화 아키텍처로 인해 리소스에 부담을 줄 수 있으며, 따라서
백업 예약을 계획할 때 하나의 리소스를 강조하지 않도록 해야한다.

예를 들면, 하나의 호스트 또는 LUN에서 동시에 여러 가상 시스템을 백업하지 말아야 한다. 예약을
조정하여 특정 리소스가 과도하게 사용되지 않도록 해야한다.

**5. 수신 거부 및 VSS 작동 방식을 학습하라**

- 백업 애플리케이션의 일관성유지를 위해 VM 백업에 데이터베이스 및 이메일 서버 같은 트랜잭션 
애플리케이션이 포함되는 경우 해당 작업을 중지하고 실행에 적합한 상태인지 확인해야 한다.

백업이 시작되기 전에 애플리케이션이 일시 중지되어 디스크에 미해결 트랜잭션이나 쓰기가 작성
되는지 확인해야하며, 이 단계를 통해 서버가 정상인지 확인하고 VM 복구가 필요한 경우 데이터가
손실되지 않도록 한다.

VMware 툴에는 Microsoft의 VSS(Volume Shadow Copy Service)와 연동하면서 백업 전에 애플리
케이션 작업을 중지시키는 드라이버가 있다.

필요에 따라서 다른 밴더들도 운영체제별 서비스를 제공하기 위해 유사한 드라이버를 출시하게 되
었다.

**6. 스냅샷은 백업이 아니다.**

- 가상 시스템 스냅샷은 유용하지만 기본적인 백업 수단으로 사용되어선 안된다. 스냅샷은 가상
시스템의 단기 백업 수단으로 유용하지만, 계속 사용하면 사용 시마다 불이익이 발생한다는 사실을
기억해야한다.

스냅샷은 모든 VM의 디스크 쓰기가 다른 새 델타 디스크 파일로 대체 되면서 원본 디스크가 읽기 
전용이 된다.

데이터가 델타 디스크 파일에 기록될 때마다 16MB씩 증가하고 증가할 때마다 해당 LUN이 잠기면서
성능이 저하될 수 있다. 결국 스냅샷이 많을수록 성능에는 악영향을 미친다.

또한 스냅샷은 각각 원본 디스크 크기만큼 증가할 수 있으므로 추가 디스크 공간을 차지하게 되며,
스냅샷 데이터를 삭제한 후 원본으로 병합하는 일은 엄청난 I/O 작업이 요구된다.

스냅샷은 새로운 가상 디스크를 생성하여 원본에 다시 연결하는 것이므로, 일부 기능이 사라질수
있다. 이 경우 스냅샷과 원본 디스크 간 매핑이라는 새로운 문제로 이어질 수 있다.

**7. 내결함성 백업이라는 대안을 고려하라.**

- 이미지 레벨 백업을 포함한 가상화 백업 제품을 대부분 VM 스냅샷을 사용하여 백업 실행 중에 
디스크 쓰기를 중단한다.

내결함성(FT) 기능은 두 대의 가상 시스템(기본과 보조)를 사용하며, 이들은 별도의 호스트에 있지
만 동일한 가상 디스크 파일을 공유한다.

현재 FT 기능은 스냅샷을 지원하지 않으며 FT지원 VM을 백업하는 프로세스가 복잡해질 수 있으므로
대안이 되는 백업 방법을 찾아야 한다.

한 가지 방법은 백업 프로세스 중 FT 기능을 일시적으로 비활성화 하여 스냅샷을 생성하는 것이다.
이 기능을 비활성화 하면 두번째 VM을 보존할 수 있다. 사 후 백업 스크립트와 함께 PowerShell을
사용하여 이 프로세스를 자동화 할 수있다.

또 다른 방법으로는 다른 카피본을 생성하도록 vCenter Converter나 vCenter Server 중 하나를 
사용하여 VM을 복제 하는 것이다. 새 카피본을 백업한 후에는 해당 복제본을 삭제할 수 있다.

8. 호스트 및 vCenter Server 구성을 백업하라.

- 손실된 호스트나 vCenter는 간단히 재구축할 수 있지만, 이 경우 구성 정보는 잃게 된다.
따라서 정기적으로 해단 정보를 백업하는 것이 좋다.

백업 호스트를 사용하면 관리 콘솔 내에 저장된 개별 파일이 아닌 VM만 백업하며 구성 정보를 백업
해두면 나중에 호스트를 재구축하기 쉬워진다.
```